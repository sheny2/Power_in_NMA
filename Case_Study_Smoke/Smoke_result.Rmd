---
title: "Smoke_Result"
author: "Yicheng Shen"
date: "2023-06-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(gemtc)
library(netmeta)
data("smoking")
data("smokingcessation")

# as.numeric(c(pi_a, pi_b, pi_c, pi_d))
```

## Treatment: 
##  A = no intervention, 
##  B = self-help, 
##  C = individual counseling,
##  D = group counseling.

```{r}
load("smokingcessation_ab.RData")
network <- mtc.network(smokingcessation_ab)
cons.model <- mtc.model(network, type="consistency", likelihood="binom", link="logit", linearModel="random")
cons.out <- mtc.run(cons.model, n.adapt=20000, n.iter=50000, thin=1)
summary(cons.out)
gemtc::forest(cons.out)
```


```{r}
load("result_smoke.RData")
result_smoke
```



```{r}
mapping <- c('A' = 1, 'B' = 2, 'C' = 3, 'D' = 4)

smokingcessation_eff = smokingcessation_ab
smokingcessation_eff$treatment <- mapping[smokingcessation_eff$treatment]


smoke_eff = data.frame(sid = smokingcessation_ab$study, tid = smokingcessation_eff$treatment, 
                       r = smokingcessation_ab$responders, n = smokingcessation_ab$sampleSize)
library("igraph")
source("functions.R")
dir.binary(smoke_eff)
eff.binary(smoke_eff)
```

```{r, fig.width=10, fig.height=6}
load("smokingcessation_ab.RData")

replace_values <- function(x) {
  x <- gsub("A", "A_no_intervention", x)
  x <- gsub("B", "B_self_help", x)
  x <- gsub("C", "C_individual_counseling", x)
  x <- gsub("D", "D_group_counseling", x)
  return(x)
}

# Apply the function to the 'treatment' variable
smokingcessation_ab$treatment <- replace_values(smokingcessation_ab$treatment)

network <- mtc.network(smokingcessation_ab)
plot(network)
```


```{r}
load("smokingcessation_ab.RData")
library(pcnetmeta)
nma.networkplot(study, treatment, data = smokingcessation_ab, title = "Smoking Sessation Treatments", node.col = "orange", edge.col = "gray", adjust.thick = 10,
  trtname = c("A: No intervention", "B: Self help", "C: Individual counseling", "D: Group counseling"))

nma.networkplot(study, treatment, data = smokingcessation_ab, title = "Smoking Sessation", node.col = "orange")
```












