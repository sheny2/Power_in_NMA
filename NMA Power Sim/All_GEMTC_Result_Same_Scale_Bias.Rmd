---
title: "Result"
author: "Yicheng Shen"
date: "2023-04-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, cache = T, warning = F, eval = T, message = F)
library(metafor)
library(tidyverse)
library(kableExtra)
library(latex2exp)
ggplot2::theme_set(ggplot2::theme_bw())
knitr::opts_chunk$set(out.width = "100%", fig.align = 'center')
```

### All bayesian gemtc


##### —————————————————————————————————————————

```{r}
load("df_indirect_BNMA_bias2.RData")
load("df_direct_BNMA_bias2.RData")
load("df_overall_BNMA_bias2.RData")
```

# power in indirect evidence

```{r, fig.height=5.5, fig.width=12}
load("df_indirect_BNMA_bias2.RData")
load("df_direct_BNMA_bias2.RData")
load("df_overall_BNMA_bias2.RData")

gridExtra::grid.arrange(

df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.1) %>% 
  ggplot(aes(x = k_ac, y = power, color = factor(OR_bc)))  + 
  geom_hline(size = 1.2, aes(yintercept = power, color = factor(OR_bc))) +
  facet_wrap(~tau) + 
  labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 6, pi_A = 0.1$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Power")  + ylim(0,1)
,
df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.1) %>% 
  ggplot(aes(x = k_ac, y = power, color = factor(OR_bc)))  + 
  geom_hline(size = 1.2, aes(yintercept = power, color = factor(OR_bc))) +
  facet_wrap(~tau) + 
  labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 12, pi_A = 0.1$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Power") + ylim(0,1)

,

df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.5) %>% 
  ggplot(aes(x = k_ac, y = power, color = factor(OR_bc)))  + 
  geom_hline(size = 1.2, aes(yintercept = power, color = factor(OR_bc))) +
  facet_wrap(~tau) +
  labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 6, pi_A = 0.5$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Power")  + ylim(0,1)
,
df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.5) %>% 
  ggplot(aes(x = k_ac, y = power, color = factor(OR_bc)))  + 
  geom_hline(size = 1.2, aes(yintercept = power, color = factor(OR_bc))) +
  facet_wrap(~tau) +
  labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 12, pi_A = 0.5$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Power") + ylim(0,1)
)
```


##  ranking correct in indirect evidence 
```{r, fig.height=5.5, fig.width=12}
# ranking correct in indirect evidence

gridExtra::grid.arrange(

df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.1) %>% 
  ggplot(aes(x = k_ac, y = rank_correct, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = rank_correct, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 6, pi_A = 0.1$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Probability of Correct Ranking")  + ylim(0.5,1)
,
df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.1) %>% 
  ggplot(aes(x = k_ac, y = rank_correct, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = rank_correct, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 12, pi_A = 0.1$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Probability of Correct Ranking") + ylim(0.5,1)

,

df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.5) %>% 
  ggplot(aes(x = k_ac, y = rank_correct, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = rank_correct, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 6, pi_A = 0.5$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Probability of Correct Ranking")  + ylim(0.5,1)
,
df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.5) %>% 
  ggplot(aes(x = k_ac, y = rank_correct, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = rank_correct, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 12, pi_A = 0.5$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Probability of Correct Ranking") + ylim(0.5,1)
)
```


### Power Direct
```{r, fig.height=5.5, fig.width=12}

### Power Direct

gridExtra::grid.arrange(

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(1,2,3,6), pi_a = 0.1", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + ylim(0,1)

,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(2,4,6,12), pi_a = 0.1", color = "True OR_bc") +
  scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0,1)

,

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(1,2,3,6), pi_a = 0.5", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(0,1)

,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi:  k_bc in c(2,4,6,12), pi_a = 0.5", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0,1)
)

```

### Rank Correct Direct
```{r, fig.height=5.5, fig.width=12}

### Rank Correct Direct

gridExtra::grid.arrange(

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = rank_correct, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(1,2,3,6), pi_a = 0.1", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + ylim(0.5,1)

,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = rank_correct, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(2,4,6,12), pi_a = 0.1", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + ylim(0.5,1)

,

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = rank_correct, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(1,2,3,6), pi_a = 0.5", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + ylim(0.5,1)

,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = rank_correct, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi:  k_bc in c(2,4,6,12), pi_a = 0.5", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + ylim(0.5,1)
)
```

# Compare direct and indirect evidence powers
```{r, fig.height=5.5, fig.width=12}
# Compare direct and indirect evidence powers

# png('direct_indirect_power.png', width = 800, height = 400)

gridExtra::grid.arrange(

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc)))  + geom_line(size = 1.2) + facet_wrap(~tau) +   
  labs(title = TeX("Direct ($k_{BC}$) vs. Indirect ($k_{AB} = k_{AC} = 6$) Evidence, $pi_a = 0.1$"), x = TeX("$k_{BC}$"), color = TeX("True $OR_{BC}$"), y = "Power") + 
  geom_hline(linetype = "dashed", data = df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.1), aes(yintercept = power, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + ylim(0,1)
,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc)))  + geom_line(size = 1.2) + facet_wrap(~tau) +  
  labs(title = TeX("Direct ($k_{BC}$) vs. Indirect ($k_{AB} = k_{AC} = 12$) Evidence, $pi_a = 0.1$"), x = TeX("$k_{BC}$"), color = TeX("True $OR_{BC}$"), y = "Power") + geom_hline(linetype = "dashed", data = df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.1), aes(yintercept = power, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + ylim(0,1)

,

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc)))  + geom_line(size = 1.2) + facet_wrap(~tau) + 
    labs(title = TeX("Direct ($k_{BC}$) vs. Indirect ($k_{AB} = k_{AC} = 6$) Evidence, $pi_a = 0.5$"), x = TeX("$k_{BC}$"), color = TeX("True $OR_{BC}$"), y = "Power") + geom_hline(linetype = "dashed", data = df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.5), aes(yintercept = power, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(0,1)
,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc)))  + geom_line(size = 1.2) + facet_wrap(~tau) + 
  labs(title = TeX("Direct ($k_{BC}$) vs. Indirect ($k_{AB} = k_{AC} = 12$) Evidence, $pi_a = 0.5$"), x = TeX("$k_{BC}$"), color = TeX("True $OR_{BC}$"), y = "Power") + geom_hline(linetype = "dashed", data = df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.5), aes(yintercept = power, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0,1)
)
```


# Compare direct and indirect evidence rank
```{r, fig.height=5.5, fig.width=12}
# Compare direct and indirect evidence rank

# png('direct_indirect_rank.png', width = 800, height = 400)

gridExtra::grid.arrange(

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = rank_correct, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = TeX("Direct ($k_{BC}$) vs. Indirect ($k_{AB} = k_{AC}$ = 6) Evidence, $pi_a = 0.1$"), x = TeX("$k_{BC}$"), color = TeX("True $OR_{BC}$"), y = "Probability of Correct Ranking") + geom_hline(linetype = "dashed", data = df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.1), aes(yintercept = rank_correct, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(0.5,1)
,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = rank_correct, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = TeX("Direct ($k_{BC}$) vs. Indirect ($k_{AB} = k_{AC} = 12$) Evidence, $pi_a = 0.1$"), x = TeX("$k_{BC}$"), color = TeX("True $OR_{BC}$"), y = "Probability of Correct Ranking") + geom_hline(linetype = "dashed", data = df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.1), aes(yintercept = rank_correct, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0.5,1)
,

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = rank_correct, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = TeX("Direct ($k_{BC}$) vs. Indirect ($k_{AB} = k_{AC} = 6$) Evidence, $pi_a = 0.5$"), x = TeX("$k_{BC}$"), color = TeX("True $OR_{BC}$"), y = "Probability of Correct Ranking") + geom_hline(linetype = "dashed", data = df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.5), aes(yintercept = rank_correct, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(0.5,1)
,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = rank_correct, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = TeX("Direct ($k_{BC}$) vs. Indirect ($k_{AB} = k_{AC} = 12$) Evidence, $pi_a = 0.5$"), x = TeX("$k_{BC}$"), color = TeX("True $OR_{BC}$"), y = "Probability of Correct Ranking")  + geom_hline(linetype = "dashed", data = df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.5), aes(yintercept = rank_correct, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0.5,1)
)
```

# Combined indirect direct and overall powers, with pi_a=0.1

```{r, fig.height=5.5, fig.width=12}
load("df_indirect_BNMA_bias2.RData")
load("df_direct_BNMA_bias2.RData")
load("df_overall_BNMA_bias2.RData")

df_indirect_bias = df_indirect_bias[which(df_indirect_bias$pi_a==0.1),]
df_direct_bias = df_direct_bias[which(df_direct_bias$pi_a==0.1),]
df_BNMA_bias =  df_BNMA_bias[which(df_BNMA_bias$pi_a==0.1),]

a <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = TeX("Overall vs. Only Indirect Evidence ($k_{AB}$ = $k_{AC}$ = 6)"), color = TeX("True $OR_{BC}$"), y = "Power", x = "Number of Studies") + geom_hline(linetype = "dashed", data = df_indirect_bias[which(df_indirect_bias$k_ab==6),], aes(yintercept = power, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(0,1)
  

b <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = TeX("Overall vs. Only Indirect Evidence ($k_{AB}$ = $k_{AC}$ = 12)"), color = TeX("True $OR_{BC}$"), y = "Power", x = "Number of Studies") + geom_hline(linetype = "dashed", data = df_indirect_bias[which(df_indirect_bias$k_ab==12),], aes(yintercept = power, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0,1)


c <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = TeX("Overall vs. Only Direct Evidence ($k_{BC}$ = 1, 2, 3, 6)"), color = TeX("True $OR_{BC}$"),  y = "Power", x = "Number of Studies") + geom_line(linetype = "dotdash", data = df_direct_bias[which(df_direct_bias$k_bc %in% c(1,2,3,6)),], aes(y = power, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(0,1)
  

d <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = TeX("Overall vs. Only Direct Evidence ($k_{BC}$ = 2, 4, 6, 12)"), color = TeX("True $OR_{BC}$"), y = "Power", x = "Number of Studies") + geom_line(linetype = "dotdash", data = df_direct_bias[which(df_direct_bias$k_bc %in% c(2,4,6,12)),], aes(y = power, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0,1)

gridExtra::grid.arrange(a,b,c,d,ncol = 2)

```

# Combined indirect direct and overall powers, with pi_a=0.5

```{r, fig.height=5.5, fig.width=12}
load("df_indirect_BNMA_bias2.RData")
load("df_direct_BNMA_bias2.RData")
load("df_overall_BNMA_bias2.RData")

df_indirect_bias = df_indirect_bias[which(df_indirect_bias$pi_a==0.5),]
df_direct_bias = df_direct_bias[which(df_direct_bias$pi_a==0.5),]
df_BNMA_bias =  df_BNMA_bias[which(df_BNMA_bias$pi_a==0.5),]

a <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Indirect (k_ab = k_ac = 6)", color = "True OR_bc") + theme_bw() + geom_hline(linetype = "dashed", data = df_indirect_bias[which(df_indirect_bias$k_ab==6),], aes(yintercept = power, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(0,1)
  

b <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Indirect (k_ab = k_ac = 12)", color = "True OR_bc") + theme_bw()  + geom_hline(linetype = "dashed", data = df_indirect_bias[which(df_indirect_bias$k_ab==12),], aes(yintercept = power, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0,1)


c <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Direct (k_bc = 1, 2, 3, 6)", color = "True OR_bc") + theme_bw() + geom_line(linetype = "dotdash", data = df_direct_bias[which(df_direct_bias$k_bc %in% c(1,2,3,6)),], aes(y = power, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(0,1)
  

d <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = power, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Direct (k_bc = 2, 4, 6, 12)", color = "True OR_bc") + theme_bw() + geom_line(linetype = "dotdash", data = df_direct_bias[which(df_direct_bias$k_bc %in% c(2,4,6,12)),], aes(y = power, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(0,1)

gridExtra::grid.arrange(a,b,c,d,ncol = 2)
```

##### —————————————————————————————————————————


### Bias using only indirect and only direct

```{r, fig.height=5.5, fig.width=12}
load("df_indirect_BNMA_bias2.RData")
load("df_direct_BNMA_bias2.RData")
load("df_overall_BNMA_bias2.RData")

gridExtra::grid.arrange(

df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.1) %>% 
  ggplot(aes(x = k_ac, y = avg_bias, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = avg_bias, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 6, pi_A = 0.1$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Bias")   + ylim(-0.05,0.05) + geom_hline(yintercept = 0)
,
df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.1) %>% 
  ggplot(aes(x = k_ac, y = avg_bias, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = avg_bias, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 12, pi_A = 0.1$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Bias")   + ylim(-0.05,0.05) + geom_hline(yintercept = 0)

,

df_indirect_bias %>% filter(k_ab == 6, pi_a == 0.5) %>% 
  ggplot(aes(x = k_ac, y = avg_bias, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = avg_bias, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 6, pi_A = 0.5$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Bias")    + ylim(-0.05,0.05) + geom_hline(yintercept = 0)
,
df_indirect_bias %>% filter(k_ab == 12, pi_a == 0.5) %>% 
  ggplot(aes(x = k_ac, y = avg_bias, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = avg_bias, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 12, pi_A = 0.5$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Bias")   + ylim(-0.05,0.05) + geom_hline(yintercept = 0)
)



gridExtra::grid.arrange(

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = avg_bias, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(1,2,3,6), pi_a = 0.1", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) 
  + ylim(-0.05,0.05) + geom_hline(yintercept = 0)

,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = avg_bias, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(2,4,6,12), pi_a = 0.1", color = "True OR_bc") +
  scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) 
  + ylim(-0.05,0.05) + geom_hline(yintercept = 0)

,

df_direct_bias %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = avg_bias, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(1,2,3,6), pi_a = 0.5", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))
  + ylim(-0.05,0.05) + geom_hline(yintercept = 0)

,
df_direct_bias %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = avg_bias, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi:  k_bc in c(2,4,6,12), pi_a = 0.5", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))
  + ylim(-0.05,0.05) + geom_hline(yintercept = 0)
)
```

### Bias using overall evidence

```{r, fig.height=5.5, fig.width=12}
load("df_indirect_BNMA_bias2.RData")
load("df_direct_BNMA_bias2.RData")
load("df_overall_BNMA_bias2.RData")

df_indirect_bias = df_indirect_bias[which(df_indirect_bias$pi_a==0.1),]
df_direct_bias = df_direct_bias[which(df_direct_bias$pi_a==0.1),]
df_BNMA_bias =  df_BNMA_bias[which(df_BNMA_bias$pi_a==0.1),]

a <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = avg_bias, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Indirect (k_ab = k_ac = 6)", color = "True OR_bc") + theme_bw() + geom_hline(linetype = "dashed", data = df_indirect_bias[which(df_indirect_bias$k_ab==6),], aes(yintercept = avg_bias, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(-0.05,0.05) + geom_hline(yintercept = 0)
  

b <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = avg_bias, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Indirect (k_ab = k_ac = 12)", color = "True OR_bc") + theme_bw()  + geom_hline(linetype = "dashed", data = df_indirect_bias[which(df_indirect_bias$k_ab==12),], aes(yintercept = avg_bias, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(-0.05,0.05) + geom_hline(yintercept = 0)


c <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = avg_bias, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Direct (k_bc = 1, 2, 3, 6)", color = "True OR_bc") + theme_bw() + geom_line(linetype = "dotdash", data = df_direct_bias[which(df_direct_bias$k_bc %in% c(1,2,3,6)),], aes(y = avg_bias, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1)))+ ylim(-0.05,0.05) + geom_hline(yintercept = 0)
  

d <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = avg_bias, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Direct (k_bc = 2, 4, 6, 12)", color = "True OR_bc") + theme_bw() + geom_line(linetype = "dotdash", data = df_direct_bias[which(df_direct_bias$k_bc %in% c(2,4,6,12)),], aes(y = avg_bias, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2)))+ ylim(-0.05,0.05) + geom_hline(yintercept = 0)

gridExtra::grid.arrange(a,b,c,d,ncol = 2)
```


# absolute bias (magnitude of bias)


```{r, fig.height=5.5, fig.width=12}
load("df_indirect_BNMA_bias.RData")
load("df_direct_BNMA_bias.RData")
load("df_overall_BNMA_bias.RData")
load("df_overall_BNMA_bias3.RData")

df_indirect_summ = df_indirect_bias %>% group_by(pi_a, OR_bc, tau, k_ab, k_ac) %>%
  summarise(power_prob = mean(power), rank_prob = mean(rank_correct),
            bias_avg = (mean(abs(point_est - point_true))))

df_direct_summ = df_direct_bias %>% group_by(pi_a, OR_bc, tau, k_bc) %>%
  summarise(power_prob = mean(power), rank_prob = mean(rank_correct),
            bias_avg = (mean(abs(point_est - point_true))))

# df_BNMA_summ = df_BNMA_bias %>% group_by(pi_a, OR_bc, tau, k_ab, k_ac, k_bc) %>%
#    summarise(power_prob = mean(power), rank_prob = mean(rank_correct),
#              bias_avg = (mean(point_est - point_true)))


gridExtra::grid.arrange(

df_indirect_summ %>% filter(k_ab == 6, pi_a == 0.1) %>% 
  ggplot(aes(x = k_ac, y = bias_avg, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = bias_avg, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 6, pi_A = 0.1$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Bias")  + 
  # ylim(-0.05,0.05) + 
  geom_hline(yintercept = 0)
,
df_indirect_summ %>% filter(k_ab == 12, pi_a == 0.1) %>% 
  ggplot(aes(x = k_ac, y = bias_avg, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = bias_avg, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 12, pi_A = 0.1$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Bias")  + 
  # ylim(-0.05,0.05) + 
  geom_hline(yintercept = 0)

,

df_indirect_summ %>% filter(k_ab == 6, pi_a == 0.5) %>% 
  ggplot(aes(x = k_ac, y = bias_avg, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = bias_avg, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 6, pi_A = 0.5$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Bias")  + 
  # ylim(-0.05,0.05) + 
  geom_hline(yintercept = 0)
,
df_indirect_summ %>% filter(k_ab == 12, pi_a == 0.5) %>% 
  ggplot(aes(x = k_ac, y = bias_avg, color = factor(OR_bc)))  + geom_hline(size = 1.2, aes(yintercept = bias_avg, color = factor(OR_bc))) +
  facet_wrap(~tau) + labs(title = TeX("Indirect Evidence: $k_{AB} = k_{AC} = 12, pi_A = 0.5$"), color = TeX("True: $OR_{BC}$"), x = "", y = "Bias")   + 
  # ylim(-0.05,0.05) + 
  geom_hline(yintercept = 0)
)


gridExtra::grid.arrange(

df_direct_summ %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = bias_avg, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(1,2,3,6), pi_a = 0.1", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + 
  # ylim(-0.05,0.05) + 
  geom_hline(yintercept = 0)

,
df_direct_summ %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.1) %>% 
  ggplot(aes(x = k_bc, y = bias_avg, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(2,4,6,12), pi_a = 0.1", color = "True OR_bc") +
  scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + 
  # ylim(-0.05,0.05) + 
  geom_hline(yintercept = 0)

,

df_direct_summ %>% filter(k_bc %in% c(1,2,3,6), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = bias_avg, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi: k_bc in c(1,2,3,6), pi_a = 0.5", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + 
  # ylim(-0.05,0.05) + 
  geom_hline(yintercept = 0)

,
df_direct_summ %>% filter(k_bc %in% c(2,4,6,12), pi_a == 0.5) %>% 
  ggplot(aes(x = k_bc, y = bias_avg, color = factor(OR_bc)))  + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Direct Evi:  k_bc in c(2,4,6,12), pi_a = 0.5", color = "True OR_bc") + 
  scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + 
  # ylim(-0.05,0.05) + 
  geom_hline(yintercept = 0)
)
```

## Overall evidence in comparison, pi_a = 0.1

```{r, fig.height=5.5, fig.width=12}
load("df_indirect_BNMA_bias.RData")
load("df_direct_BNMA_bias.RData")
load("df_overall_BNMA_bias.RData")
load("df_overall_BNMA_bias3.RData")

df_indirect_summ = df_indirect_bias %>% group_by(pi_a, OR_bc, tau, k_ab, k_ac) %>%
  summarise(power_prob = mean(power), rank_prob = mean(rank_correct),
            bias_avg = (mean(abs(point_est - point_true))))

df_direct_summ = df_direct_bias %>% group_by(pi_a, OR_bc, tau, k_bc) %>%
  summarise(power_prob = mean(power), rank_prob = mean(rank_correct),
            bias_avg = (mean(abs(point_est - point_true))))



df_indirect_summ = df_indirect_summ[which(df_indirect_summ$pi_a==0.1),]
df_direct_summ = df_direct_summ[which(df_direct_summ$pi_a==0.1),]
df_BNMA_bias =  df_BNMA_bias[which(df_BNMA_bias$pi_a==0.1),]

a <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = avg_bias_abs, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Indirect (k_ab = k_ac = 6)", color = "True OR_bc") + theme_bw() + geom_hline(linetype = "dashed", data = df_indirect_summ[which(df_indirect_summ$k_ab==6),], aes(yintercept = bias_avg, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + geom_hline(yintercept = 0)
  

b <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = avg_bias_abs, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Indirect (k_ab = k_ac = 12)", color = "True OR_bc") + theme_bw()  + geom_hline(linetype = "dashed", data = df_indirect_summ[which(df_indirect_summ$k_ab==12),], aes(yintercept = bias_avg, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + geom_hline(yintercept = 0) 


c <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = avg_bias_abs, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Direct (k_bc = 1, 2, 3, 6)", color = "True OR_bc") + theme_bw() + geom_line(linetype = "dotdash", data = df_direct_summ[which(df_direct_summ$k_bc %in% c(1,2,3,6)),], aes(y = bias_avg, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + geom_hline(yintercept = 0)
  

d <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = avg_bias_abs, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Direct (k_bc = 2, 4, 6, 12)", color = "True OR_bc") + theme_bw() + geom_line(linetype = "dotdash", data = df_direct_summ[which(df_direct_summ$k_bc %in% c(2,4,6,12)),], aes(y = bias_avg, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + geom_hline(yintercept = 0)

gridExtra::grid.arrange(a,b,c,d,ncol = 2)
```

## Overall evidence in comparison, pi_a = 0.5

```{r, fig.height=5.5, fig.width=12}
load("df_indirect_BNMA_bias.RData")
load("df_direct_BNMA_bias.RData")
load("df_overall_BNMA_bias.RData")
load("df_overall_BNMA_bias3.RData")

df_indirect_summ = df_indirect_bias %>% group_by(pi_a, OR_bc, tau, k_ab, k_ac) %>%
  summarise(power_prob = mean(power), rank_prob = mean(rank_correct),
            bias_avg = (mean(abs(point_est - point_true))))

df_direct_summ = df_direct_bias %>% group_by(pi_a, OR_bc, tau, k_bc) %>%
  summarise(power_prob = mean(power), rank_prob = mean(rank_correct),
            bias_avg = (mean(abs(point_est - point_true))))


df_indirect_summ = df_indirect_summ[which(df_indirect_summ$pi_a==0.5),]
df_direct_summ = df_direct_summ[which(df_direct_summ$pi_a==0.5),]
df_BNMA_bias =  df_BNMA_bias[which(df_BNMA_bias$pi_a==0.5),]

a <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = avg_bias_abs, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Indirect (k_ab = k_ac = 6)", color = "True OR_bc") + theme_bw() + geom_hline(linetype = "dashed", data = df_indirect_summ[which(df_indirect_summ$k_ab==6),], aes(yintercept = bias_avg, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + geom_hline(yintercept = 0)
  

b <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = avg_bias_abs, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Indirect (k_ab = k_ac = 12)", color = "True OR_bc") + theme_bw()  + geom_hline(linetype = "dashed", data = df_indirect_summ[which(df_indirect_summ$k_ab==12),], aes(yintercept = bias_avg, color = factor(OR_bc))) + scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + geom_hline(yintercept = 0) 


c <- df_BNMA_bias %>% filter(k_ab == 6) %>% 
  ggplot(aes(x = k_bc, y = avg_bias_abs, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Direct (k_bc = 1, 2, 3, 6)", color = "True OR_bc") + theme_bw() + geom_line(linetype = "dotdash", data = df_direct_summ[which(df_direct_summ$k_bc %in% c(1,2,3,6)),], aes(y = bias_avg, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(1, 6, 1), labels = as.character(seq(1, 6, 1))) + geom_hline(yintercept = 0)
  

d <- df_BNMA_bias %>% filter(k_ab == 12) %>% 
  ggplot(aes(x = k_bc, y = avg_bias_abs, color = factor(OR_bc))) + geom_line(size = 1.2) +
  facet_wrap(~tau) + labs(title = "Overall vs. Only Direct (k_bc = 2, 4, 6, 12)", color = "True OR_bc") + theme_bw() + geom_line(linetype = "dotdash", data = df_direct_summ[which(df_direct_summ$k_bc %in% c(2,4,6,12)),], aes(y = bias_avg, x = k_bc, color = factor(OR_bc)))+ scale_x_continuous(breaks = seq(2, 12, 2), labels = as.character(seq(2, 12, 2))) + geom_hline(yintercept = 0)

gridExtra::grid.arrange(a,b,c,d,ncol = 2)
```